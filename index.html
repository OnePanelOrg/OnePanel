<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="author" content="" />
    <meta name="viewport" content="width=device-width">
    <title></title>

    <link rel="stylesheet" href="main.css">
</head>
<body>
    <main>
      <div class="sidepanel">
        <h1>MANGA READER</h1>
        <label>
          fitscreen
          <input type="checkbox" name="fitscreen">
        </label>
      </div>
      <div class="viewer">
        <div class="view-box">
          <img src="" class="page hidden">
          <img src="" class="panel hidden">
        </div>
      </div>
    </main>

    <script src="reader.js"></script>
    <script>
      let polyfillsNeeded = [];

      const loadScripts = (urls, yeyCallback, neyCallback) => {
        let count = urls.length;
        let errored = false;

        if (urls.length == 0) return yeyCallback();

        urls.forEach(function(url) {
          var script = document.createElement('script');
          script.onload = function() {
            if (errored) return;
            if (!--count) yeyCallback();
          };
          script.onerror = function() {
            if (errored) return;
            neyCallback();
            errored = true;
          };
          script.src = url;
          document.head.insertBefore(script, document.head.firstChild);
        });
      };

      if (!('Promise' in window)) {
        polyfillsNeeded.push('polyfills/promise.js');
      }

      window.addEventListener('load', _ => {
        loadScripts(polyfillsNeeded, _ => {
          window.reader = new Reader([
            {
              image: 'images/one/01.jpg',
              panels: [
                {x: 79.15, y: 0, width: 20.85, height: 47.32, path: "79.42% 0%,100% 0%,100% 46.49%,93.43% 46.4%,93.43% 47.32%,86.32% 47.05%,86.32% 46.4%,79.15% 45.85%"},
                {x: 78.75, y: 46.68, width: 21.25, height: 53.32, path: "79.28% 48.06%,94.56% 47.51%,100% 46.68%,100% 100%,78.75% 100%"},
                {x: 0, y: 0, width: 85.19, height: 100, path: "0% 0%,79.42% 0%,79.15% 46.12%,85.19% 46.58%,85.06% 48.16%,79.15% 48.25%,78.75% 100%,0% 100%"}
              ]
            },
            {
              image: 'images/one/02.jpg',
              panels: [
                {x: 6.07, y: 0, width: 93.93, height: 34.05, path: "6.41% 0%,100% 0%,100% 34.05%,6.07% 34.01%"},
                {x: 5.85, y: 35.08, width: 89.1, height: 26.26, path: "6.19% 35.27%,94.95% 35.08%,93.87% 61.34%,5.85% 60.95%"},
                {x: 38.2, y: 62.17, width: 61.8, height: 37.83, path: "38.82% 62.17%,100% 62.77%,100% 100%,38.2% 100%"},
                {x: 5.9, y: 63.28, width: 32.47, height: 36.72, path: "6.47% 63.28%,38.37% 63.44%,38.08% 100%,5.9% 100%"}
              ]
            },
            {
              image: 'images/one/03.jpg',
              panels: [
                {x: 0, y: 0, width: 99.8, height: 100, path: "0% 0%,94.03% 0%,93.96% 96.04%,99.8% 96.22%,99.67% 100%,0% 100%"}
              ]
            },
            {
              image: 'images/one/04.jpg',
              panels: [
                {x: 5.84, y: 0, width: 94.16, height: 38.18, path: "5.84% 0%,100% 0%,100% 36.76%,49.67% 36.63%,49.67% 38.18%,5.97% 37.95%"},
                {x: 50, y: 36.72, width: 50, height: 27.95, path: "50% 36.72%,100% 37.04%,100% 64.57%,52.36% 64.67%"},
                {x: 53.35, y: 64.71, width: 46.65, height: 35.29, path: "53.35% 64.71%,100% 64.76%,100% 100%,55.45% 100%"},
                {x: 5.58, y: 38.22, width: 49.14, height: 61.78, path: "6.17% 38.22%,28.41% 38.5%,28.74% 39.64%,50.2% 39.87%,54.72% 100%,5.58% 100%"}
              ]
            }
          ]);
        });

        document.querySelector('input[name="fitscreen"]').addEventListener('change', event => {
          window.reader.fitScreenToggle();
        })
      });

    </script>
</body>
</html>
